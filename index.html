<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>App Cantina</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<!-- DependÃªncias externas -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="js/supabase.js"></script>
  <script src="js/app.js"></script>
  <script src="js/cantina.js"></script>
  <script src="js/aluno.js"></script>

<!-- LOGIN -->
<div class="container" id="login">
  <h1>ğŸ½ï¸ Cantina</h1>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button class="btn-full" id="btnLogin">Login</button>
</div>

<!-- MENU PRINCIPAL ALUNO -->
<div class="container hidden" id="alunoMenuSelect">
  <h2 id="alunoMenuTitle"></h2>
  <div id="saldo" style="font-size:18px; font-weight:700; margin-bottom:20px; color:var(--primary);"></div>
  <div id="alunoButtons"></div>
  <button class="btn-full" onclick="logout()">Sair</button>
</div>

<!-- MENU PRINCIPAL CANTINA -->
<div class="container hidden" id="cantinaMenuSelect">
  <h2 id="cantinaMenuTitle"></h2>
  <div id="cantinButtons"></div>
  <button class="btn-full" onclick="logout()">Sair</button>
</div>

<!-- MENU SELECT (DEPRECATED - SUBSTITUÃDO PELOS ACIMA) -->
<div class="container hidden" id="menuSelect">
  <h2 id="menuTitle"></h2>
  <div id="buttons"></div>
  <button class="btn-full" onclick="logout()">Sair</button>
</div>

<!-- CRIAR MENU -->
<div class="container hidden" id="cantinaMenu">
  <h2>â• Criar Menu</h2>
  <div style="width:100%;text-align:left;">
    <label>ğŸ“… Data:</label>
    <input id="dataMenu" type="date" style="width:100%;max-width:none;margin:0 0 20px 0;padding:12px 14px;border:2px solid #e0e0e0;">
    
    <label>ğŸ½ï¸ Tipo:</label>
    <select id="tipoMenu" style="width:100%;max-width:none;margin:0 0 20px 0;padding:12px 14px;border:2px solid #e0e0e0;">
      <option value="pequeno_almoco">ğŸ¥ Pequeno-almoÃ§o (2â‚¬)</option>
      <option value="almoco">ğŸ½ï¸ AlmoÃ§o (4â‚¬)</option>
      <option value="jantar">ğŸ² Jantar (4â‚¬)</option>
    </select>
    
    <label>ğŸ³ Prato (apenas almoÃ§o):</label>
    <input id="pratoMenu" placeholder="Ex: Frango com arroz" style="width:100%;max-width:none;margin:0 0 24px 0;padding:12px 14px;border:2px solid #e0e0e0;">
  </div>
  
  <button class="btn-full" id="btnAddMenu">âœ… Adicionar Menu</button>
  <button class="btn-back" onclick="menu()">Voltar</button>
</div>

<!-- MENUS CRIADOS -->
<div class="container hidden" id="cantinaMenus">
  <h2>Menus Criados</h2>
  <div style="width:100%;text-align:left;margin-bottom:20px;">
    <label style="margin-bottom:10px;">ğŸ” Filtrar por data (opcional):</label>
    <input type="date" id="diaMenu" style="width:100%;max-width:none;margin:0;padding:12px 14px;border:2px solid #e0e0e0;">
    <small style="display:block;margin-top:6px;color:#999;">Deixa vazio para ver todos os menus</small>
  </div>
  <div id="listaMenus"></div>
  <button class="btn-back" onclick="menu()">Voltar</button>
</div>

<!-- RESERVAS DO DIA -->
<div class="container hidden" id="cantinaReservas">
  <h2>Reservas do Dia</h2>
  <div id="reservasDia"></div>
  <button class="btn-back" onclick="menu()">Voltar</button>
</div>

<!-- HISTÃ“RICO -->
<div class="container hidden" id="cantinaHistorico">
  <h2>ğŸ“š HistÃ³rico de Reservas</h2>
  
  <!-- Pesquisa e Filtros de Alunos (lista inicial) -->
  <div class="alunos-pesquisa-box" id="alunosPesquisaBox" style="display: none;">
    <div class="alunos-pesquisa">
      <input 
        type="text" 
        id="pesquisaAlunos" 
        placeholder="ğŸ” Pesquisar aluno por nome..." 
        onkeyup="filtrarAlunos()"
      />
    </div>
    <div class="alunos-info">
      <span id="alunosContagemResultados"></span>
    </div>
  </div>
  
  <!-- Lista de Alunos -->
  <div class="alunos-lista-container">
    <div id="listaAlunosHistorico"></div>
  </div>
  
  <!-- Filtros e Pesquisa do HistÃ³rico (mostrado ao selecionar um aluno) -->
  <div class="historico-filtros-box" id="historicoFiltrosBox" style="display: none;">
    <div class="historico-pesquisa">
      <input 
        type="text" 
        id="pesquisaHistorico" 
        placeholder="ğŸ” Pesquisar por prato..." 
        onkeyup="filtrarHistorico()"
      />
    </div>
    
    <div class="historico-filters">
      <select id="filtroTipoHistorico" onchange="filtrarHistorico()" class="filter-select">
        <option value="">ğŸ“‹ Todos os tipos</option>
        <option value="pequeno_almoco">ğŸ¥ Pequeno-almoÃ§o</option>
        <option value="almoco">ğŸ½ï¸ AlmoÃ§o</option>
        <option value="jantar">ğŸŒ™ Jantar</option>
        <option value="dieta">ğŸ¥— Dieta</option>
      </select>
      
      <select id="filtroStatusHistorico" onchange="filtrarHistorico()" class="filter-select">
        <option value="">âœ¨ Todos os status</option>
        <option value="ativa">âœ… Ativa</option>
        <option value="cancelada">âŒ Cancelada</option>
      </select>
      
      <button class="btn-filter-reset" onclick="resetarFiltrosHistorico()">ğŸ”„ Limpar</button>
    </div>
  </div>

  <!-- HistÃ³rico do Aluno -->
  <div id="historico"></div>
  
  <div class="botoes-historico">
    <button class="btn-back" onclick="backToHistoricoList()" id="btnBackHistorico" style="display: none;">â¬…ï¸ Voltar a Alunos</button>
    <button class="btn-back" onclick="menu()" id="btnBackMenu">Voltar</button>
  </div>
</div>

<!-- SALDOS -->
<div class="container hidden" id="cantinaSaldos">
  <h2>Saldos em DÃ­vida</h2>
  
  <!-- Caixa de Pesquisa e Filtros -->
  <div class="saldos-filtros-box">
    <div class="saldos-pesquisa">
      <input 
        type="text" 
        id="pesquisaSaldos" 
        placeholder="ğŸ” Pesquisar por nome..." 
        onkeyup="filtrarSaldos()"
      />
    </div>
    <div class="saldos-botoes-filtro">
      <button class="btn-filter" onclick="ordenarSaldos('nome')" title="Ordenar Aâ†’Z">ğŸ“ Nome</button>
      <button class="btn-filter" onclick="ordenarSaldos('valor')" title="Ordenar por valor">ğŸ’° Valor</button>
      <button class="btn-filter" onclick="resetarFiltrosSaldos()" title="Limpar filtros">ğŸ”„ Limpar</button>
    </div>
  </div>

  <!-- Caixa de Resultados -->
  <div class="saldos-resultados-box">
    <div id="listaSaldos"></div>
  </div>
  
  <div class="acoes">
    <button class="btn-medium" onclick="exportarSaldosExcel()">ğŸ“¥ Exportar Saldos em DÃ­vida</button>
    <button class="btn-medium" onclick="abrirRelatorioMensal()">ğŸ“Š RelatÃ³rio Mensal</button>
  </div>
  <button class="btn-back" onclick="menu()">Voltar</button>
</div>

<!-- DETALHE SALDO ALUNO -->
<div class="container hidden" id="cantinaSaldoAluno">
  <h2 id="tituloAluno"></h2>
  <div class="card-divida">
    <span>DÃ­vida Total</span>
    <strong id="valorTotal">â‚¬0.00</strong>
  </div>
  <div id="mesesDivida"></div>
  <button id="btnLiquidarTotal" class="btn-full danger hidden" onclick="liquidarDividaTotal(alunoAtual)">Liquidar DÃ­vida Total</button>
  <button class="btn-full" onclick="exportarHistoricoAluno()">ğŸ“¥ Exportar HistÃ³rico</button>
  <button class="btn-back" onclick="showCantinaSaldos()">Voltar</button>
</div>

<!-- RELATÃ“RIO MENSAL -->
<div class="container hidden" id="paginaRelatorio">
  <h2>RelatÃ³rio Mensal</h2>
  <div class="filtros-relatorio">
    <select id="relatorioAno"></select>
    <select id="relatorioMes"></select>
  </div>
  <button onclick="prepararRelatorio()">ğŸ“Š Preparar RelatÃ³rio</button>
  <button class="btn-full" onclick="gerarRelatorioMensal()">Gerar Excel</button>
  <button class="btn-back" onclick="showCantinaSaldos()">Voltar</button>
</div>

<!-- ALUNO - MENU -->
<div class="container hidden" id="alunoMenu">
  <h2>Reservar Menu</h2>
  <label for="filtroTipoAluno">Filtrar por tipo:</label>
  <select id="filtroTipoAluno" onchange="showAlunoMenu()">
    <option value="">Todos</option>
    <option value="pequeno_almoco">ğŸ¥ Pequeno-almoÃ§o</option>
    <option value="almoco">ğŸ½ï¸ AlmoÃ§o</option>
    <option value="jantar">ğŸŒ™ Jantar</option>
    <option value="dieta">ğŸ¥— Dieta</option>
  </select>
  <div id="listaAlunoMenu"></div>
</div>

<!-- ALUNO - MINHAS RESERVAS -->
<div class="container hidden" id="alunoReservas">
  <h2>Minhas Reservas</h2>
  <div id="minhasReservas"></div>
</div>

<!-- ALERTAS -->
<div class="container hidden" id="alertasAluno">
  <h2>Alertas</h2>
  <div id="alertasDia"></div>
</div>

</body>
</html>
